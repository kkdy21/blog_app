# Alembic 명령어 가이드

Alembic을 사용하여 데이터베이스 스키마를 관리하기 위한 주요 명령어 목록입니다.
모든 명령어는 `docker-compose exec app` 접두사를 사용하여 컨테이너 내부에서 실행해야 합니다.

---

### 1. 마이그레이션 스크립트 생성 (가장 중요)

모델(ORM) 파일이 변경되었을 때, 변경 사항을 감지하여 새로운 마이그레이션 스크립트 파일을 생성합니다.

```bash
docker-compose exec app alembic revision --autogenerate -m "변경 사항에 대한 요약 메시지"
```
- `-m "..."`: 마이그레이션 파일에 대한 설명을 추가합니다. 어떤 변경사항인지 알아보기 쉽게 작성하는 것이 좋습니다.
- 이 명령을 실행하면 `alembic/versions` 디렉토리에 새로운 파이썬 파일이 생성됩니다.

---

### 2. 마이그레이션 적용 (가장 중요)

생성된 마이그레이션 스크립트를 실제 데이터베이스에 적용하여 스키마를 업데이트합니다.

```bash
# 최신 버전까지 모든 미적용 마이그레이션을 적용합니다.
docker-compose exec app alembic upgrade head

# 특정 버전으로 업그레이드할 수도 있습니다.
docker-compose exec app alembic upgrade <revision_id>
```
- `head`는 가장 최신 버전을 의미합니다.

---

### 3. 마이그레이션 되돌리기 (Downgrade)

적용된 마이그레이션을 이전 상태로 되돌립니다.

```bash
# 가장 최근에 적용된 마이그레이션 1개를 되돌립니다.
docker-compose exec app alembic downgrade -1

# 모든 마이그레이션을 되돌려 초기 상태로 만듭니다.
docker-compose exec app alembic downgrade base
```
- **주의:** 데이터 손실이 발생할 수 있으므로 프로덕션 환경에서는 신중하게 사용해야 합니다.

---

### 4. 마이그레이션 기록 및 상태 확인

마이그레이션 내역과 현재 데이터베이스의 상태를 확인합니다.

```bash
# 전체 마이그레이션 기록을 봅니다.
docker-compose exec app alembic history

# 현재 데이터베이스에 적용된 리비전을 보여줍니다.
docker-compose exec app alembic current

# 사용 가능한 최신 리비전(head)을 보여줍니다.
docker-compose exec app alembic show head
```